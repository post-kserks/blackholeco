"""
–°–ª—É—á–∞–π–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –∏ —Å–æ–±—ã—Ç–∏—è –≤ –∫–æ—Å–º–æ—Å–µ (–ø–æ–ª–∏—Ü–∏—è, –ø–∏—Ä–∞—Ç—ã –∏ —Ç.–¥.)
"""

import random
from utils.io import print_slow


def check_police_encounter(state):
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Å—Ç—Ä–µ—á—É —Å –ø–æ–ª–∏—Ü–∏–µ–π.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True, –µ—Å–ª–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø–æ–ª—ë—Ç.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç False, –µ—Å–ª–∏ –ø–æ–ª—ë—Ç –ø—Ä–µ—Ä–≤–∞–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç—é—Ä—å–º–∞ –∏–ª–∏ —Å–º–µ—Ä—Ç—å).
    """
    # 20% —à–∞–Ω—Å –≤—Å—Ç—Ä–µ—á–∏
    if random.random() > 0.2:
        return True

    print_slow("\n" + "=" * 40)
    print_slow("üöî –í–ù–ò–ú–ê–ù–ò–ï! –í–∞—Å –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ü–æ–ª–∏—Ü–∏—è.")
    print_slow("–ü–∞—Ç—Ä—É–ª—å —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –≤–∞—à –≥—Ä—É–∑–æ–≤–æ–π –æ—Ç—Å–µ–∫...")

    # –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–∫–∞–∑–∞ –∏–ª–∏ –≥—Ä—É–∑ –ª–µ–≥–∞–ª—å–Ω—ã–π
    if not state.current_order or not state.current_order.is_contraband:
        print_slow("\n[–ü–æ–ª–∏—Ü–∏—è]: –í—Å—ë —á–∏—Å—Ç–æ. –°—á–∞—Å—Ç–ª–∏–≤–æ–≥–æ –ø—É—Ç–∏.")
        print_slow("=" * 40)
        return True

    # –ï—Å–ª–∏ –≥—Ä—É–∑ ‚Äî –∫–æ–Ω—Ç—Ä–∞–±–∞–Ω–¥–∞
    print_slow("\n[–ü–æ–ª–∏—Ü–∏—è]: –û–ë–ù–ê–†–£–ñ–ï–ù–ê –ö–û–ù–¢–†–ê–ë–ê–ù–î–ê!")
    print_slow(f"–ì—Ä—É–∑ '{state.current_order.cargo}' –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.")
    
    reward = state.current_order.reward
    bribe_amount = int(reward * (2/3))
    fine_confess = reward
    fine_fail_bribe = reward * 2

    print_slow("\n–ß—Ç–æ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å?")
    print(f"1. –î–∞—Ç—å –≤–∑—è—Ç–∫—É ({bribe_amount} –∫—Ä.) [–®–∞–Ω—Å 50%]")
    print(f"2. –ü—Ä–∏–∑–Ω–∞—Ç—å –≤–∏–Ω—É (–®—Ç—Ä–∞—Ñ {fine_confess} –∫—Ä. + –ö–æ–Ω—Ñ–∏—Å–∫–∞—Ü–∏—è)")

    while True:
        choice = input("> ").strip()
        
        # 1. –í–∑—è—Ç–∫–∞
        if choice == "1":
            if state.money < bribe_amount:
                print_slow("–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –≤–∑—è—Ç–∫–∏.")
                continue

            # –ü–æ–ø—ã—Ç–∫–∞ –¥–∞—á–∏ –≤–∑—è—Ç–∫–∏
            if random.random() < 0.5:
                # –£—Å–ø–µ—Ö
                state.spend_money(bribe_amount)
                print_slow(f"\n[–ü–æ–ª–∏—Ü–∏—è]: (–®—ë–ø–æ—Ç–æ–º) –ü—Ä–æ–µ–∑–∂–∞–π—Ç–µ. –ò —á—Ç–æ–± —è –≤–∞—Å –±–æ–ª—å—à–µ –Ω–µ –≤–∏–¥–µ–ª.")
                return True
            else:
                # –ü—Ä–æ–≤–∞–ª
                print_slow("\n[–ü–æ–ª–∏—Ü–∏—è]: –ü–û–ü–´–¢–ö–ê –ü–û–î–ö–£–ü–ê –î–û–õ–ñ–ù–û–°–¢–ù–û–ì–û –õ–ò–¶–ê!")
                print_slow(f"–í–∞–º –≤—ã–ø–∏—Å–∞–Ω —à—Ç—Ä–∞—Ñ –≤ –¥–≤–æ–π–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ: {fine_fail_bribe} –∫—Ä.")
                
                if state.spend_money(fine_fail_bribe):
                    print_slow("–ì—Ä—É–∑ –∫–æ–Ω—Ñ–∏—Å–∫–æ–≤–∞–Ω.")
                    state.current_order.fail(state) # –ü—Ä–æ–≤–∞–ª –∑–∞–∫–∞–∑–∞ (—Ä–µ–ø—É—Ç–∞—Ü–∏—è –ø–∞–¥–∞–µ—Ç)
                    return True
                else:
                    print_slow("–£ –≤–∞—Å –Ω–µ—Ç –¥–µ–Ω–µ–≥ –Ω–∞ –æ–ø–ª–∞—Ç—É —à—Ç—Ä–∞—Ñ–∞.")
                    print_slow("–í–∞—Å –∞—Ä–µ—Å—Ç–æ–≤—ã–≤–∞—é—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –≤ —Ç—é—Ä—å–º—É.")
                    state.die("–ü–æ–∂–∏–∑–Ω–µ–Ω–Ω–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ –∑–∞ –Ω–µ—É–ø–ª–∞—Ç—É —à—Ç—Ä–∞—Ñ–∞")
                    return False

        # 2. –ü—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤–∏–Ω—ã
        elif choice == "2":
            if state.spend_money(fine_confess):
                print_slow(f"\n–í—ã –æ–ø–ª–∞—Ç–∏–ª–∏ —à—Ç—Ä–∞—Ñ {fine_confess} –∫—Ä.")
                print_slow("–ì—Ä—É–∑ –∫–æ–Ω—Ñ–∏—Å–∫–æ–≤–∞–Ω.")
                state.current_order.fail(state)
                return True
            else:
                print_slow("–£ –≤–∞—Å –Ω–µ—Ç –¥–µ–Ω–µ–≥ –Ω–∞ –æ–ø–ª–∞—Ç—É —à—Ç—Ä–∞—Ñ–∞.")
                print_slow("–í–∞—Å –∞—Ä–µ—Å—Ç–æ–≤—ã–≤–∞—é—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –≤ —Ç—é—Ä—å–º—É.")
                state.die("–ü–æ–∂–∏–∑–Ω–µ–Ω–Ω–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ –∑–∞ –Ω–µ—É–ø–ª–∞—Ç—É —à—Ç—Ä–∞—Ñ–∞")
                return False
        
        else:
            print("–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä.")
